/*!
 * mq-client v1.0.16
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mqtt")):"function"==typeof define&&define.amd?define(["mqtt"],t):(e=e||self,e["mq-client"]=t(e.mqtt))})(this,function(e){'use strict';function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ie&&ie in Object(e)?te(e):re(e)}function r(e){return null!=e&&"object"==t(e)}function i(e){return"symbol"==t(e)||ce(e)&&se(e)=="[object Symbol]"}function s(e,n){if($(e))return!1;var o=t(e);return!!("number"==o||"symbol"==o||"boolean"==o||null==e||ae(e))||de.test(e)||!le.test(e)||null!=n&&e in Object(n)}function c(e){var n=t(e);return null!=e&&("object"==n||"function"==n)}function a(e){return!!ge&&ge in e}function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function d(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function p(e){var n=t(e);return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e}function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function y(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var o=arguments,r=t?t.apply(this,o):o[0],i=n.cache;if(i.has(r))return i.get(r);var s=e.apply(this,o);return n.cache=i.set(r,s)||i,s};return n.cache=new(y.Cache||Me),n}function f(e){if("string"==typeof e)return e;if($(e))return Ge(e,f)+"";if(ae(e))return Xe?Xe.call(e):"";var t=e+"";return"0"==t&&1/e==-Je?"-0":t}function g(e,t,n){var o=e[t];it.call(e,t)&&Ve(o,n)&&(n!==void 0||t in e)||ot(e,t,n)}function b(e,n){var o=t(e);return n=null==n?9007199254740991:n,!!n&&("number"==o||"symbol"!=o&&st.test(e))&&-1<e&&0==e%1&&e<n}function h(){var e,t,n=new Promise(function(){e=arguments[0],t=arguments[1]});return n.resolve=e,n.reject=t,n}function _(e){var t=Object.prototype.toString.call(e);return"[object String]"===t}function m(e){return!!(_(e)&&""!==e)}function j(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t}function O(e){var t=!1;return m(e)?t=!isNaN(+e):j(e)&&(t=!0),t}function k(e){if(!O(e))return 0;var t=Ht(e);return t}function L(e){return!!O(e)&&(e=k(e),Yt(e))}function S(e){if(!O(e))return 0;e=k(e);var t=en(e);return"0"===t+""?0:t}function x(e){if(!L(e))return!1;var t=0<S(e);return t}function A(){var e,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:32,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[],s=n.length;if(x(t))for(e=0;e<t;e++)o[e]=n[0|Math.random()*s];else if("rfc4122"===t){o[8]=o[13]=o[18]=o[23]="-",o[14]="4";var c;for(e=0;36>e;e++)o[e]||(c=0|16*Math.random(),o[e]=n[19===e?8|3&c:c])}else return"";var a=o.join("");return a}function E(e){if(!m(e))return{};var t={};try{t=JSON.parse(e)}catch(e){t={}}return t}function P(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function w(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t}function T(e){var t=Object.prototype.toString.call(e);return"[object Undefined]"===t}function z(e){var t=Object.prototype.toString.call(e);return"[object Null]"===t}function F(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t}function q(e){if(F(e)){for(var t in e)return!1;return!0}return!1}function R(e){return!!(_(e)&&""===e)}function V(e){return!!w(e)&&0===e.length}function U(e){return!!T(e)||!!z(e)||!!q(e)||!!R(e)||!!V(e)}function I(e){return!!w(e)&&0!==e.length&&!(1===e.length&&U(e[0]))}function N(e,t){if(m(e))e=[e];else if(I(e));else return!1;if(m(t))t=[t];else if(I(t));else return!1;for(var n=0;n<e.length;n++)for(var o=0;o<t.length;o++)if(e[n]===t[o])return!0;return!1}e=e&&e.hasOwnProperty("default")?e["default"]:e;var C="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,B=n(function(e){(function(n){function o(){}function r(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}function s(e){return!!("function"==typeof e||e instanceof RegExp)||!!(e&&"object"===t(e))&&s(e.listener)}var c=o.prototype,a=n.EventEmitter;c.getListeners=function(e){var t,n,o=this._getEvents();if(e instanceof RegExp)for(n in t={},o)o.hasOwnProperty(n)&&e.test(n)&&(t[n]=o[n]);else t=o[e]||(o[e]=[]);return t},c.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},c.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},c.addListener=function(e,n){if(!s(n))throw new TypeError("listener must be a function");var o,i=this.getListenersAsObject(e),c="object"===t(n);for(o in i)i.hasOwnProperty(o)&&-1===r(i[o],n)&&i[o].push(c?n:{listener:n,once:!1});return this},c.on=i("addListener"),c.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},c.once=i("addOnceListener"),c.defineEvent=function(e){return this.getListeners(e),this},c.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},c.removeListener=function(e,t){var n,o,i=this.getListenersAsObject(e);for(o in i)i.hasOwnProperty(o)&&(n=r(i[o],t),-1!==n&&i[o].splice(n,1));return this},c.off=i("removeListener"),c.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},c.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},c.manipulateListeners=function(e,n,o){var r,s,c=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"===t(n)&&!(n instanceof RegExp))for(r in n)n.hasOwnProperty(r)&&(s=n[r])&&("function"==typeof s?c.call(this,r,s):a.call(this,r,s));else for(r=o.length;r--;)c.call(this,n,o[r]);return this},c.removeEvent=function(e){var n,o=t(e),r=this._getEvents();if("string"===o)delete r[e];else if(e instanceof RegExp)for(n in r)r.hasOwnProperty(n)&&e.test(n)&&delete r[n];else delete this._events;return this},c.removeAllListeners=i("removeEvent"),c.emitEvent=function(e,t){var n,o,r,s,c,a=this.getListenersAsObject(e);for(s in a)if(a.hasOwnProperty(s))for(n=a[s].slice(0),r=0;r<n.length;r++)o=n[r],!0===o.once&&this.removeListener(e,o.listener),c=o.listener.apply(this,t||[]),c===this._getOnceReturnValue()&&this.removeListener(e,o.listener);return this},c.trigger=i("emitEvent"),c.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},c.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},c._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},c._getEvents=function(){return this._events||(this._events={})},o.noConflict=function(){return n.EventEmitter=a,o},e.exports?e.exports=o:n.EventEmitter=o})("undefined"==typeof window?C||{}:window)}),M=Array.isArray,$=M,D="object"==t(C)&&C&&C.Object===Object&&C,W=D,G="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,J=W||G||Function("return this")(),H=J,X=H.Symbol,Y=X,Z=Object.prototype,Q=Z.hasOwnProperty,K=Z.toString,ee=Y?Y.toStringTag:void 0,te=function(e){var t=Q.call(e,ee),n=e[ee];try{e[ee]=void 0;var o=!0}catch(t){}var r=K.call(e);return o&&(t?e[ee]=n:delete e[ee]),r},ne=Object.prototype,oe=ne.toString,re=function(e){return oe.call(e)},ie=Y?Y.toStringTag:void 0,se=o,ce=r,ae=i,le=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,de=/^\w*$/,pe=c,ue=function(e){if(!pe(e))return!1;var t=se(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},ye=H["__core-js_shared__"],fe=ye,ge=function(){var e=/[^.]+$/.exec(fe&&fe.keys&&fe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),be=Function.prototype,he=be.toString,_e=function(e){if(null!=e){try{return he.call(e)}catch(t){}try{return e+""}catch(t){}}return""},me=/[\\^$.*+?()[\]{}|]/g,je=/^\[object .+?Constructor\]$/,ve=Function.prototype,Oe=Object.prototype,ke=ve.toString,Le=Oe.hasOwnProperty,Se=RegExp("^"+ke.call(Le).replace(me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xe=function(e){if(!pe(e)||a(e))return!1;var t=ue(e)?Se:je;return t.test(_e(e))},Ae=function(e,t){return null==e?void 0:e[t]},Ee=function(e,t){var n=Ae(e,t);return xe(n)?n:void 0},Pe=Ee(Object,"create"),we=Pe,Te=Object.prototype,ze=Te.hasOwnProperty,Fe=Object.prototype,qe=Fe.hasOwnProperty;l.prototype.clear=function(){this.__data__=we?we(null):{},this.size=0},l.prototype["delete"]=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},l.prototype.get=function(e){var t=this.__data__;if(we){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return ze.call(t,e)?t[e]:void 0},l.prototype.has=function(e){var t=this.__data__;return we?t[e]!==void 0:qe.call(t,e)},l.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=we&&void 0===t?"__lodash_hash_undefined__":t,this};var Re=l,Ve=function(e,t){return e===t||e!==e&&t!==t},Ue=function(e,t){for(var n=e.length;n--;)if(Ve(e[n][0],t))return n;return-1},Ie=Array.prototype,Ne=Ie.splice;d.prototype.clear=function(){this.__data__=[],this.size=0},d.prototype["delete"]=function(e){var t=this.__data__,n=Ue(t,e);if(0>n)return!1;var o=t.length-1;return n==o?t.pop():Ne.call(t,n,1),--this.size,!0},d.prototype.get=function(e){var t=this.__data__,n=Ue(t,e);return 0>n?void 0:t[n][1]},d.prototype.has=function(e){return-1<Ue(this.__data__,e)},d.prototype.set=function(e,t){var n=this.__data__,o=Ue(n,e);return 0>o?(++this.size,n.push([e,t])):n[o][1]=t,this};var Ce=Ee(H,"Map"),Be=function(e,t){var n=e.__data__;return p(t)?n["string"==typeof t?"string":"hash"]:n.map};u.prototype.clear=function(){this.size=0,this.__data__={hash:new Re,map:new(Ce||d),string:new Re}},u.prototype["delete"]=function(e){var t=Be(this,e)["delete"](e);return this.size-=t?1:0,t},u.prototype.get=function(e){return Be(this,e).get(e)},u.prototype.has=function(e){return Be(this,e).has(e)},u.prototype.set=function(e,t){var n=Be(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};var Me=u;y.Cache=Me;var $e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,De=/\\(\\)?/g,We=function(e){var t=y(e,function(e){return 500===n.size&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace($e,function(e,n,o,r){t.push(o?r.replace(De,"$1"):n||e)}),t}),Ge=function(e,t){for(var n=-1,o=null==e?0:e.length,r=Array(o);++n<o;)r[n]=t(e[n],n,e);return r},Je=1/0,He=Y?Y.prototype:void 0,Xe=He?He.toString:void 0,Ye=function(e){return null==e?"":f(e)},Ze=function(e,t){return $(e)?e:s(e,t)?[e]:We(Ye(e))},Qe=function(e){if("string"==typeof e||ae(e))return e;var t=e+"";return"0"==t&&1/e==-(1/0)?"-0":t},Ke=function(e,t){t=Ze(t,e);for(var n=0,o=t.length;null!=e&&n<o;)e=e[Qe(t[n++])];return n&&n==o?e:void 0},et=function(e,t,n){var o=null==e?void 0:Ke(e,t);return o===void 0?n:o},tt=function(){try{var e=Ee(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),nt=tt,ot=function(e,t,n){"__proto__"==t&&nt?nt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},rt=Object.prototype,it=rt.hasOwnProperty,st=/^(?:0|[1-9]\d*)$/,ct=b,at=function(e,t,n,o){if(!pe(e))return e;t=Ze(t,e);for(var r=-1,i=t.length,s=e;null!=s&&++r<i;){var c=Qe(t[r]),a=n;if(r!=i-1){var l=s[c];a=o?o(l,c,s):void 0,a===void 0&&(a=pe(l)?l:ct(t[r+1])?[]:{})}g(s,c,a),s=s[c]}return e},lt=function(e,t,n){return null==e?e:at(e,t,n)},dt=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o&&!(!1===t(e[n],n,e)););return e},pt=function(e){return function(t,n,o){for(var r=-1,i=Object(t),s=o(t),c=s.length;c--;){var a=s[e?c:++r];if(!1===n(i[a],a,i))break}return t}}(),ut=function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o},yt=function(e){return ce(e)&&se(e)=="[object Arguments]"},ft=Object.prototype,gt=ft.hasOwnProperty,bt=ft.propertyIsEnumerable,ht=yt(function(){return arguments}())?yt:function(e){return ce(e)&&gt.call(e,"callee")&&!bt.call(e,"callee")},_t=function(){return!1},mt=n(function(e,t){var n=t&&!t.nodeType&&t,o=n&&!0&&e&&!e.nodeType&&e,r=o&&o.exports===n,i=r?H.Buffer:void 0,s=i?i.isBuffer:void 0;e.exports=s||_t}),jt=function(e){return"number"==typeof e&&-1<e&&0==e%1&&e<=9007199254740991},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var Ot=n(function(e,t){var n=t&&!t.nodeType&&t,o=n&&!0&&e&&!e.nodeType&&e,r=o&&o.exports===n,i=r&&W.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e?e:i&&i.binding&&i.binding("util")}catch(t){}}();e.exports=s}),kt=Ot&&Ot.isTypedArray,Lt=kt?function(e){return function(t){return e(t)}}(kt):function(e){return ce(e)&&jt(e.length)&&!!vt[se(e)]},St=Object.prototype,xt=St.hasOwnProperty,At=function(e,t){var n=$(e),o=!n&&ht(e),r=!n&&!o&&mt(e),i=!n&&!o&&!r&&Lt(e),s=n||o||r||i,c=s?ut(e.length,String):[],a=c.length;for(var l in e)(t||xt.call(e,l))&&!(s&&("length"==l||r&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||ct(l,a)))&&c.push(l);return c},Et=Object.prototype,Pt=function(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||Et;return e===n},wt=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),Tt=Object.prototype,zt=Tt.hasOwnProperty,Ft=function(e){if(!Pt(e))return wt(e);var t=[];for(var n in Object(e))zt.call(e,n)&&"constructor"!=n&&t.push(n);return t},qt=function(e){return null!=e&&jt(e.length)&&!ue(e)},Rt=function(e){return qt(e)?At(e):Ft(e)},Vt=function(e,t){return function(n,o){if(null==n)return n;if(!qt(n))return e(n,o);for(var r=n.length,i=t?r:-1,s=Object(n);(t?i--:++i<r)&&!(!1===o(s[i],i,s)););return n}}(function(e,t){return e&&pt(e,t,Rt)}),Ut=function(e){return e},It=function(e){return"function"==typeof e?e:Ut},Nt=function(e,t){var n=$(e)?dt:Vt;return n(e,It(t))},Ct=0/0,Bt=/^\s+|\s+$/g,Mt=/^[-+]0x[0-9a-f]+$/i,$t=/^0b[01]+$/i,Dt=/^0o[0-7]+$/i,Wt=parseInt,Gt=function(e){if("number"==typeof e)return e;if(ae(e))return Ct;if(pe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=pe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Bt,"");var n=$t.test(e);return n||Dt.test(e)?Wt(e.slice(2),n?2:8):Mt.test(e)?Ct:+e},Jt=1/0,Ht=function(e){if(!e)return 0===e?e:0;if(e=Gt(e),e===Jt||e===-Jt){var t=0>e?-1:1;return 1.7976931348623157e+308*t}return e===e?e:0},Xt=function(e){var t=Ht(e),n=t%1;return t===t?n?t-n:t:0},Yt=function(e){return"number"==typeof e&&e==Xt(e)},Zt=H.isFinite,Qt=Math.min,Kt=function(e){var t=Math[e];return function(e,n){if(e=Gt(e),n=null==n?0:Qt(Xt(n),292),n&&Zt(e)){var o=(Ye(e)+"e").split("e"),r=t(o[0]+"e"+(+o[1]+n));return o=(Ye(r)+"e").split("e"),+(o[0]+"e"+(+o[1]-n))}return t(e)}}("round"),en=Kt;return function(t){function n(){function n(e){var t=h();return y.connected?y.subscribe(e,{qos:2},function(e){e?t.reject("subscribe error: no send"):t.resolve()}):t.reject("subscribe error: no connect"),t}function o(e){r(u,e)}function r(e,t){y.connected&&y.publish(e,JSON.stringify(t),{qos:2,retain:!1})}function s(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=h(),i=A(),s={token:t.token,_id:i,func:e,input:n};return o(s),d.on(i,function(e){r.resolve(e),d.removeAllListeners(i)}),r}var a=h(),l={},p=A();c=p,t.url||(t.url="mqtt://localhost:8080"),t.token||(t.token="*");var u="topic|"+A(),y=null;try{y=e.connect(t.url,{username:t.token})}catch(e){return i(),a.reject(),a}return y.on("connect",function(){c===p?(P(t.open)&&t.open(),n(u).then(function(){return s("getFuncs",null)})["catch"](function(e){P(t.error)&&t.error(e)})):y.end()}),y.on("message",function(e,t){if(c===p){var n=E(t.toString("utf8"));if("sys"===et(n,"output.sys")&&et(n,"output.funcs")){for(var o=n.output.funcs,r=function(e){var t=o[e];lt(l,t,function(e){return s(t,e)})},u=0;u<o.length;u++)r(u);a.resolve(l)}if(et(n,"_id")&&et(n,"output")){var f=et(n,"_id"),g=et(n,"output");d.emit(f,g)}}else y.end()}),y.on("reconnect",function(){}),y.on("offline",function(){y.end(),P(t.close)&&t.close(),i()}),y.on("error",function(e){P(t.error)&&t.error(e)}),a}function o(e){if(0===l)l++,a=e,s.resolve(a);else{var t=Rt(a),n=Rt(e);Nt(n,function(t){a[t]=e[t]}),Nt(t,function(e){N(n,e)||delete a[e]})}}function r(){new n().then(function(e){o(e)})["catch"](function(){})}function i(){setTimeout(function(){P(t.reconn)&&t.reconn(),r()},5e3)}var s=h(),c="",a={},l=0,d=new B;return r(),s}});
//# sourceMappingURL=mq-client.umd.js.map
