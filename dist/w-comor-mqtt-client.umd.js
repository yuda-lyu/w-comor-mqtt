/*!
 * w-comor-mqtt-client v1.0.24
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("mqtt")):"function"==typeof define&&define.amd?define(["mqtt"],n):(t=t||self)["w-comor-mqtt-client"]=n(t.mqtt)}(this,(function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n=Array.isArray;function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t,n){return t(n={exports:{}},n.exports),n.exports}var u="object"==r(e)&&e&&e.Object===Object&&e,i="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,c=u||i||Function("return this")(),a=c.Symbol,f=Object.prototype,s=f.hasOwnProperty,l=f.toString,v=a?a.toStringTag:void 0;var p=function(t){var n=s.call(t,v),r=t[v];try{t[v]=void 0;var e=!0}catch(t){}var o=l.call(t);return e&&(n?t[v]=r:delete t[v]),o},h=Object.prototype.toString;var y=function(t){return h.call(t)},b="[object Null]",d="[object Undefined]",_=a?a.toStringTag:void 0;var j=function(t){return null==t?void 0===t?d:b:_&&_ in Object(t)?p(t):y(t)};var g=function(t){return null!=t&&"object"==r(t)},m="[object Symbol]";var O=function(t){return"symbol"==r(t)||g(t)&&j(t)==m},w=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,x=/^\w*$/;var S=function(t,e){if(n(t))return!1;var o=r(t);return!("number"!=o&&"symbol"!=o&&"boolean"!=o&&null!=t&&!O(t))||(x.test(t)||!w.test(t)||null!=e&&t in Object(e))};var A=function(t){var n=r(t);return null!=t&&("object"==n||"function"==n)},P="[object AsyncFunction]",k="[object Function]",T="[object GeneratorFunction]",F="[object Proxy]";var $,z=function(t){if(!A(t))return!1;var n=j(t);return n==k||n==T||n==P||n==F},N=c["__core-js_shared__"],C=($=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var q=function(t){return!!C&&C in t},E=Function.prototype.toString;var L=function(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""},M=/^\[object .+?Constructor\]$/,I=Function.prototype,U=Object.prototype,B=I.toString,R=U.hasOwnProperty,D=RegExp("^"+B.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var J=function(t){return!(!A(t)||q(t))&&(z(t)?D:M).test(L(t))};var G=function(t,n){return null==t?void 0:t[n]};var V=function(t,n){var r=G(t,n);return J(r)?r:void 0},W=V(Object,"create");var H=function(){this.__data__=W?W(null):{},this.size=0};var K=function(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},Q="__lodash_hash_undefined__",X=Object.prototype.hasOwnProperty;var Y=function(t){var n=this.__data__;if(W){var r=n[t];return r===Q?void 0:r}return X.call(n,t)?n[t]:void 0},Z=Object.prototype.hasOwnProperty;var tt=function(t){var n=this.__data__;return W?void 0!==n[t]:Z.call(n,t)},nt="__lodash_hash_undefined__";var rt=function(t,n){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=W&&void 0===n?nt:n,this};function et(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}et.prototype.clear=H,et.prototype.delete=K,et.prototype.get=Y,et.prototype.has=tt,et.prototype.set=rt;var ot=et;var ut=function(){this.__data__=[],this.size=0};var it=function(t,n){return t===n||t!=t&&n!=n};var ct=function(t,n){for(var r=t.length;r--;)if(it(t[r][0],n))return r;return-1},at=Array.prototype.splice;var ft=function(t){var n=this.__data__,r=ct(n,t);return!(r<0)&&(r==n.length-1?n.pop():at.call(n,r,1),--this.size,!0)};var st=function(t){var n=this.__data__,r=ct(n,t);return r<0?void 0:n[r][1]};var lt=function(t){return ct(this.__data__,t)>-1};var vt=function(t,n){var r=this.__data__,e=ct(r,t);return e<0?(++this.size,r.push([t,n])):r[e][1]=n,this};function pt(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}pt.prototype.clear=ut,pt.prototype.delete=ft,pt.prototype.get=st,pt.prototype.has=lt,pt.prototype.set=vt;var ht=pt,yt=V(c,"Map");var bt=function(){this.size=0,this.__data__={hash:new ot,map:new(yt||ht),string:new ot}};var dt=function(t){var n=r(t);return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t};var _t=function(t,n){var r=t.__data__;return dt(n)?r["string"==typeof n?"string":"hash"]:r.map};var jt=function(t){var n=_t(this,t).delete(t);return this.size-=n?1:0,n};var gt=function(t){return _t(this,t).get(t)};var mt=function(t){return _t(this,t).has(t)};var Ot=function(t,n){var r=_t(this,t),e=r.size;return r.set(t,n),this.size+=r.size==e?0:1,this};function wt(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}wt.prototype.clear=bt,wt.prototype.delete=jt,wt.prototype.get=gt,wt.prototype.has=mt,wt.prototype.set=Ot;var xt=wt,St="Expected a function";function At(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new TypeError(St);var r=function r(){var e=arguments,o=n?n.apply(this,e):e[0],u=r.cache;if(u.has(o))return u.get(o);var i=t.apply(this,e);return r.cache=u.set(o,i)||u,i};return r.cache=new(At.Cache||xt),r}At.Cache=xt;var Pt=At,kt=500;var Tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ft=/\\(\\)?/g,$t=function(t){var n=Pt(t,(function(t){return r.size===kt&&r.clear(),t})),r=n.cache;return n}((function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(Tt,(function(t,r,e,o){n.push(e?o.replace(Ft,"$1"):r||t)})),n}));var zt=function(t,n){for(var r=-1,e=null==t?0:t.length,o=Array(e);++r<e;)o[r]=n(t[r],r,t);return o},Nt=1/0,Ct=a?a.prototype:void 0,qt=Ct?Ct.toString:void 0;var Et=function t(r){if("string"==typeof r)return r;if(n(r))return zt(r,t)+"";if(O(r))return qt?qt.call(r):"";var e=r+"";return"0"==e&&1/r==-Nt?"-0":e};var Lt=function(t){return null==t?"":Et(t)};var Mt=function(t,r){return n(t)?t:S(t,r)?[t]:$t(Lt(t))},It=1/0;var Ut=function(t){if("string"==typeof t||O(t))return t;var n=t+"";return"0"==n&&1/t==-It?"-0":n};var Bt=function(t,n){for(var r=0,e=(n=Mt(n,t)).length;null!=t&&r<e;)t=t[Ut(n[r++])];return r&&r==e?t:void 0};var Rt=function(t,n,r){var e=null==t?void 0:Bt(t,n);return void 0===e?r:e},Dt=function(){try{var t=V(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Jt=function(t,n,r){"__proto__"==n&&Dt?Dt(t,n,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[n]=r},Gt=Object.prototype.hasOwnProperty;var Vt=function(t,n,r){var e=t[n];Gt.call(t,n)&&it(e,r)&&(void 0!==r||n in t)||Jt(t,n,r)},Wt=9007199254740991,Ht=/^(?:0|[1-9]\d*)$/;var Kt=function(t,n){var e=r(t);return!!(n=null==n?Wt:n)&&("number"==e||"symbol"!=e&&Ht.test(t))&&t>-1&&t%1==0&&t<n};var Qt=function(t,n,r,e){if(!A(t))return t;for(var o=-1,u=(n=Mt(n,t)).length,i=u-1,c=t;null!=c&&++o<u;){var a=Ut(n[o]),f=r;if(o!=i){var s=c[a];void 0===(f=e?e(s,a,c):void 0)&&(f=A(s)?s:Kt(n[o+1])?[]:{})}Vt(c,a,f),c=c[a]}return t};var Xt=function(t,n,r){return null==t?t:Qt(t,n,r)};var Yt=function(t,n){for(var r=-1,e=null==t?0:t.length;++r<e&&!1!==n(t[r],r,t););return t};var Zt=function(t){return function(n,r,e){for(var o=-1,u=Object(n),i=e(n),c=i.length;c--;){var a=i[t?c:++o];if(!1===r(u[a],a,u))break}return n}}();var tn=function(t,n){for(var r=-1,e=Array(t);++r<t;)e[r]=n(r);return e},nn="[object Arguments]";var rn=function(t){return g(t)&&j(t)==nn},en=Object.prototype,on=en.hasOwnProperty,un=en.propertyIsEnumerable,cn=rn(function(){return arguments}())?rn:function(t){return g(t)&&on.call(t,"callee")&&!un.call(t,"callee")};var an=function(){return!1},fn=o((function(t,n){var r=n&&!n.nodeType&&n,e=r&&t&&!t.nodeType&&t,o=e&&e.exports===r?c.Buffer:void 0,u=(o?o.isBuffer:void 0)||an;t.exports=u})),sn=9007199254740991;var ln=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=sn},vn={};vn["[object Float32Array]"]=vn["[object Float64Array]"]=vn["[object Int8Array]"]=vn["[object Int16Array]"]=vn["[object Int32Array]"]=vn["[object Uint8Array]"]=vn["[object Uint8ClampedArray]"]=vn["[object Uint16Array]"]=vn["[object Uint32Array]"]=!0,vn["[object Arguments]"]=vn["[object Array]"]=vn["[object ArrayBuffer]"]=vn["[object Boolean]"]=vn["[object DataView]"]=vn["[object Date]"]=vn["[object Error]"]=vn["[object Function]"]=vn["[object Map]"]=vn["[object Number]"]=vn["[object Object]"]=vn["[object RegExp]"]=vn["[object Set]"]=vn["[object String]"]=vn["[object WeakMap]"]=!1;var pn=function(t){return g(t)&&ln(t.length)&&!!vn[j(t)]};var hn=function(t){return function(n){return t(n)}},yn=o((function(t,n){var r=n&&!n.nodeType&&n,e=r&&t&&!t.nodeType&&t,o=e&&e.exports===r&&u.process,i=function(){try{var t=e&&e.require&&e.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),bn=yn&&yn.isTypedArray,dn=bn?hn(bn):pn,_n=Object.prototype.hasOwnProperty;var jn=function(t,r){var e=n(t),o=!e&&cn(t),u=!e&&!o&&fn(t),i=!e&&!o&&!u&&dn(t),c=e||o||u||i,a=c?tn(t.length,String):[],f=a.length;for(var s in t)!r&&!_n.call(t,s)||c&&("length"==s||u&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Kt(s,f))||a.push(s);return a},gn=Object.prototype;var mn=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||gn)};var On=function(t,n){return function(r){return t(n(r))}}(Object.keys,Object),wn=Object.prototype.hasOwnProperty;var xn=function(t){if(!mn(t))return On(t);var n=[];for(var r in Object(t))wn.call(t,r)&&"constructor"!=r&&n.push(r);return n};var Sn=function(t){return null!=t&&ln(t.length)&&!z(t)};var An=function(t){return Sn(t)?jn(t):xn(t)};var Pn=function(t,n){return function(r,e){if(null==r)return r;if(!Sn(r))return t(r,e);for(var o=r.length,u=n?o:-1,i=Object(r);(n?u--:++u<o)&&!1!==e(i[u],u,i););return r}}((function(t,n){return t&&Zt(t,n,An)}));var kn=function(t){return t};var Tn=function(t){return"function"==typeof t?t:kn};var Fn=function(t,r){return(n(t)?Yt:Pn)(t,Tn(r))};function $n(){var t,n,r=new Promise((function(){t=arguments[0],n=arguments[1]}));return r.resolve=t,r.reject=n,r}var zn=NaN,Nn=/^\s+|\s+$/g,Cn=/^[-+]0x[0-9a-f]+$/i,qn=/^0b[01]+$/i,En=/^0o[0-7]+$/i,Ln=parseInt;var Mn=function(t){if("number"==typeof t)return t;if(O(t))return zn;if(A(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=A(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Nn,"");var r=qn.test(t);return r||En.test(t)?Ln(t.slice(2),r?2:8):Cn.test(t)?zn:+t},In=1/0,Un=17976931348623157e292;var Bn=function(t){return t?(t=Mn(t))===In||t===-In?(t<0?-1:1)*Un:t==t?t:0:0===t?t:0};var Rn=function(t){var n=Bn(t),r=n%1;return n==n?r?n-r:n:0};var Dn=function(t){return"number"==typeof t&&t==Rn(t)};function Jn(t){return"[object String]"===Object.prototype.toString.call(t)}function Gn(t){return!(!Jn(t)||""===t)}function Vn(t){var n=!1;return Gn(t)?n=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(n=!0),n}function Wn(t){return Vn(t)?Bn(t):0}var Hn=c.isFinite,Kn=Math.min;var Qn=function(t){var n=Math[t];return function(t,r){if(t=Mn(t),(r=null==r?0:Kn(Rn(r),292))&&Hn(t)){var e=(Lt(t)+"e").split("e"),o=n(e[0]+"e"+(+e[1]+r));return+((e=(Lt(o)+"e").split("e"))[0]+"e"+(+e[1]-r))}return n(t)}}("round");function Xn(t){return!!function(t){return!!Vn(t)&&(t=Wn(t),Dn(t))}(t)&&function(t){if(!Vn(t))return 0;t=Wn(t);var n=Qn(t);return"0"===String(n)?0:n}(t)>0}function Yn(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[],o=r.length;if(Xn(n))for(t=0;t<n;t++)e[t]=r[0|Math.random()*o];else{if("rfc4122"!==n)return"";var u;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",t=0;t<36;t++)e[t]||(u=0|16*Math.random(),e[t]=r[19===t?3&u|8:u])}return e.join("")}var Zn=o((function(t){var n=Object.prototype.hasOwnProperty,r="~";function e(){}function o(t,n,r){this.fn=t,this.context=n,this.once=r||!1}function u(t,n,e,u,i){if("function"!=typeof e)throw new TypeError("The listener must be a function");var c=new o(e,u||t,i),a=r?r+n:n;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function i(t,n){0==--t._eventsCount?t._events=new e:delete t._events[n]}function c(){this._events=new e,this._eventsCount=0}Object.create&&(e.prototype=Object.create(null),(new e).__proto__||(r=!1)),c.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},c.prototype.listeners=function(t){var n=r?r+t:t,e=this._events[n];if(!e)return[];if(e.fn)return[e.fn];for(var o=0,u=e.length,i=new Array(u);o<u;o++)i[o]=e[o].fn;return i},c.prototype.listenerCount=function(t){var n=r?r+t:t,e=this._events[n];return e?e.fn?1:e.length:0},c.prototype.emit=function(t,n,e,o,u,i){var c=r?r+t:t;if(!this._events[c])return!1;var a,f,s=this._events[c],l=arguments.length;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,n),!0;case 3:return s.fn.call(s.context,n,e),!0;case 4:return s.fn.call(s.context,n,e,o),!0;case 5:return s.fn.call(s.context,n,e,o,u),!0;case 6:return s.fn.call(s.context,n,e,o,u,i),!0}for(f=1,a=new Array(l-1);f<l;f++)a[f-1]=arguments[f];s.fn.apply(s.context,a)}else{var v,p=s.length;for(f=0;f<p;f++)switch(s[f].once&&this.removeListener(t,s[f].fn,void 0,!0),l){case 1:s[f].fn.call(s[f].context);break;case 2:s[f].fn.call(s[f].context,n);break;case 3:s[f].fn.call(s[f].context,n,e);break;case 4:s[f].fn.call(s[f].context,n,e,o);break;default:if(!a)for(v=1,a=new Array(l-1);v<l;v++)a[v-1]=arguments[v];s[f].fn.apply(s[f].context,a)}}return!0},c.prototype.on=function(t,n,r){return u(this,t,n,r,!1)},c.prototype.once=function(t,n,r){return u(this,t,n,r,!0)},c.prototype.removeListener=function(t,n,e,o){var u=r?r+t:t;if(!this._events[u])return this;if(!n)return i(this,u),this;var c=this._events[u];if(c.fn)c.fn!==n||o&&!c.once||e&&c.context!==e||i(this,u);else{for(var a=0,f=[],s=c.length;a<s;a++)(c[a].fn!==n||o&&!c[a].once||e&&c[a].context!==e)&&f.push(c[a]);f.length?this._events[u]=1===f.length?f[0]:f:i(this,u)}return this},c.prototype.removeAllListeners=function(t){var n;return t?(n=r?r+t:t,this._events[n]&&i(this,n)):(this._events=new e,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,t.exports=c}));function tr(){return new Zn}function nr(t){var n=Object.prototype.toString.call(t);return"[object Function]"===n||"[object AsyncFunction]"===n}function rr(t){return"[object Array]"===Object.prototype.toString.call(t)}function er(t){if(function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)){for(var n in t)return!1;return!0}return!1}function or(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!er(t)||(!!function(t){return!(!Jn(t)||""!==t)}(t)||!!function(t){return!!rr(t)&&0===t.length}(t))))}function ur(t){return!!rr(t)&&(0!==t.length&&(1!==t.length||!or(t[0])))}return function(n){var r=$n(),e="",o={},u=0,i=new tr;function c(){var r=$n(),o={},u=Yn();e=u,n.url||(n.url="mqtt://localhost:8080"),n.token||(n.token="*");var c="topic|"+Yn(),a=null;try{a=t.connect(n.url,{username:n.token})}catch(t){return s(),r.reject(),r}function f(t){!function(t,n){a.connected&&a.publish(t,JSON.stringify(n),{qos:2,retain:!1})}(c,t)}function l(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=$n(),o=Yn();return f({token:n.token,_id:o,func:t,input:r}),i.on(o,(function(t){e.resolve(t),i.removeAllListeners(o)})),e}return a.on("connect",(function(){e===u?(nr(n.open)&&n.open(),function(t){var n=$n();return a.connected?a.subscribe(t,{qos:2},(function(t){t?n.reject("subscribe error: no send"):n.resolve()})):n.reject("subscribe error: no connect"),n}(c).then((function(){return l("getFuncs",null)})).catch((function(t){nr(n.error)&&n.error(t)}))):a.end()})),a.on("message",(function(t,n){if(e===u){var c=function(t){if(!Gn(t))return{};var n={};try{n=JSON.parse(t)}catch(t){n={}}return n}(n.toString("utf8"));if("sys"===Rt(c,"output.sys")&&Rt(c,"output.funcs")){for(var f=c.output.funcs,s=function(t){var n=f[t];Xt(o,n,(function(t){return l(n,t)}))},v=0;v<f.length;v++)s(v);r.resolve(o)}if(Rt(c,"_id")&&Rt(c,"output")){var p=Rt(c,"_id"),h=Rt(c,"output");i.emit(p,h)}}else a.end()})),a.on("reconnect",(function(){})),a.on("offline",(function(){a.end(),nr(n.close)&&n.close(),s()})),a.on("error",(function(t){nr(n.error)&&n.error(t)})),r}function a(t){if(0===u)u++,o=t,r.resolve(o);else{var n=An(o),e=An(t);Fn(e,(function(n){o[n]=t[n]})),Fn(n,(function(t){(function(t,n){if(Gn(t))t=[t];else if(!ur(t))return!1;if(Gn(n))n=[n];else if(!ur(n))return!1;for(var r=0;r<t.length;r++)for(var e=0;e<n.length;e++)if(t[r]===n[e])return!0;return!1})(e,t)||delete o[t]}))}}function f(){(new c).then((function(t){a(t)})).catch((function(){}))}function s(){setTimeout((function(){nr(n.reconn)&&n.reconn(),f()}),5e3)}return f(),r}}));
//# sourceMappingURL=w-comor-mqtt-client.umd.js.map
